<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; img-src 'self' data:; font-src 'self' data: https://fonts.gstatic.com; connect-src 'self' https://models.inference.ai.azure.com;">
  <title>EmeraldNotes</title>
  <!-- Google Fonts for Obsidian-like typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <!-- Highlight.js for syntax highlighting with VS Code Dark+ theme -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div style="display: flex; align-items: center; gap: 8px;">
          <img src="assets/icon.png" alt="Logo" id="home-logo" style="width: 24px; height: 24px; cursor: pointer;" title="Go to Home">
          <h2 style="margin: 0;">Notes</h2>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="new-note-btn" title="New Note">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="12" y1="18" x2="12" y2="12"></line>
              <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
          </button>
          <button class="icon-btn" id="new-folder-btn" title="New Folder">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              <line x1="12" y1="11" x2="12" y2="17"></line>
              <line x1="9" y1="14" x2="15" y2="14"></line>
            </svg>
          </button>
          <button class="icon-btn" id="select-dir-btn" title="Change Directory">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="file-tree" id="file-tree">
        <div class="empty-state">
          <p>Select a directory to get started</p>
          <button class="btn-primary" id="select-dir-empty">Choose Folder</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="editor-container" id="editor-container">
        <div class="welcome-screen">
          <div class="welcome-content">
            <img src="assets/icon.png" alt="EmeraldNotes Logo" style="width: 120px; height: 120px; margin-bottom: 20px;">
            <h1>Welcome to EmeraldNotes</h1>
            <p>Create a new note or select an existing one to get started.</p>
            <div class="welcome-actions">
              <button class="btn-primary" id="welcome-new-note">Create New Note</button>
              <button class="btn-secondary" id="welcome-select-dir">Choose Folder</button>
            </div>
          </div>
        </div>
        
        <div class="editor-wrapper" id="editor-wrapper" style="display: none;">
          <div class="editor-header">
            <input type="text" class="note-title" id="note-title" placeholder="Untitled" readonly>
            <div class="header-actions">
              <button class="ai-generate-btn" id="ai-assistant-btn" title="AI Assistant">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M14 4.4375C15.3462 4.4375 16.4375 3.34619 16.4375 2H17.5625C17.5625 3.34619 18.6538 4.4375 20 4.4375V5.5625C18.6538 5.5625 17.5625 6.65381 17.5625 8H16.4375C16.4375 6.65381 15.3462 5.5625 14 5.5625V4.4375ZM1 11C4.31371 11 7 8.31371 7 5H9C9 8.31371 11.6863 11 15 11V13C11.6863 13 9 15.6863 9 19H7C7 15.6863 4.31371 13 1 13V11ZM17.25 14C17.25 15.7949 15.7949 17.25 14 17.25V18.75C15.7949 18.75 17.25 20.2051 17.25 22H18.75C18.75 20.2051 20.2051 18.75 22 18.75V17.25C20.2051 17.25 18.75 15.7949 18.75 14H17.25Z"></path>
                </svg>
              </button>
              <button class="icon-btn" id="restore-backup-btn" title="Restore from Backup">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                  <path d="M21 3v5h-5"></path>
                  <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                  <path d="M3 21v-5h5"></path>
                </svg>
              </button>
              <button class="icon-btn" id="insert-table-btn" title="Insert Table">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="3" y1="9" x2="21" y2="9"></line>
                  <line x1="3" y1="15" x2="21" y2="15"></line>
                  <line x1="9" y1="3" x2="9" y2="21"></line>
                  <line x1="15" y1="3" x2="15" y2="21"></line>
                </svg>
              </button>
              <button class="icon-btn" id="markdown-help-btn" title="Markdown Cheat Sheet">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM11 15H13V17H11V15ZM13 13.3551V14H11V12.5C11 11.9477 11.4477 11.5 12 11.5C12.8284 11.5 13.5 10.8284 13.5 10C13.5 9.17157 12.8284 8.5 12 8.5C11.2723 8.5 10.6656 9.01823 10.5288 9.70577L8.56731 9.31346C8.88637 7.70919 10.302 6.5 12 6.5C13.933 6.5 15.5 8.067 15.5 10C15.5 11.5855 14.4457 12.9248 13 13.3551Z"></path>
                </svg>
              </button>
              <button class="icon-btn" id="toggle-code-btn" title="Toggle Code View">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="16 18 22 12 16 6"></polyline>
                  <polyline points="8 6 2 12 8 18"></polyline>
                </svg>
              </button>
              <button class="icon-btn" id="delete-note-btn" title="Delete Note">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="editor-content" id="editor-content">
            <textarea class="markdown-input" id="markdown-input" placeholder="Start typing..." style="display: none;"></textarea>
            <div class="markdown-preview editable" id="markdown-preview" contenteditable="true" data-placeholder="Start typing in markdown..."></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Context Menu -->
  <div class="context-menu" id="context-menu" style="display: none;">
    <div class="context-menu-item" data-action="rename">Rename</div>
    <div class="context-menu-item" data-action="delete">Delete</div>
    <div class="context-menu-item" data-action="show-in-explorer">Show in File Explorer</div>
  </div>

  <!-- Modal for input -->
  <div class="modal" id="input-modal" style="display: none;">
    <div class="modal-content">
      <h3 id="modal-title">Create New Item</h3>
      <input type="text" id="modal-input" placeholder="Enter name...">
      <div class="modal-actions">
        <button class="btn-secondary" id="modal-cancel">Cancel</button>
        <button class="btn-primary" id="modal-confirm">Create</button>
      </div>
    </div>
  </div>

  <!-- Table Editor Modal -->
  <div class="modal" id="table-editor-modal" style="display: none;">
    <div class="table-editor-content">
      <div class="table-editor-header">
        <h3>Table Editor</h3>
        <button class="icon-btn" id="table-editor-close" title="Close">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="table-toolbar">
        <div class="toolbar-section">
          <span class="toolbar-label">Rows:</span>
          <button class="icon-btn" id="table-add-row-above" title="Add Row Above">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <polyline points="5 12 12 5 19 12"></polyline>
            </svg>
          </button>
          <button class="icon-btn" id="table-add-row-below" title="Add Row Below">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <polyline points="19 12 12 19 5 12"></polyline>
            </svg>
          </button>
          <button class="icon-btn danger" id="table-delete-row" title="Delete Row">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="toolbar-section">
          <span class="toolbar-label">Columns:</span>
          <button class="icon-btn" id="table-add-column-left" title="Add Column Left">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 5 12 12 19"></polyline>
            </svg>
          </button>
          <button class="icon-btn" id="table-add-column-right" title="Add Column Right">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 19 19 12 12 5"></polyline>
            </svg>
          </button>
          <button class="icon-btn danger" id="table-delete-column" title="Delete Column">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="toolbar-section">
          <span class="toolbar-label">Align:</span>
          <button class="icon-btn alignment-btn active" data-align="left" title="Align Left">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="17" y1="10" x2="3" y2="10"></line>
              <line x1="21" y1="6" x2="3" y2="6"></line>
              <line x1="21" y1="14" x2="3" y2="14"></line>
              <line x1="17" y1="18" x2="3" y2="18"></line>
            </svg>
          </button>
          <button class="icon-btn alignment-btn" data-align="center" title="Align Center">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="10" x2="6" y2="10"></line>
              <line x1="21" y1="6" x2="3" y2="6"></line>
              <line x1="21" y1="14" x2="3" y2="14"></line>
              <line x1="18" y1="18" x2="6" y2="18"></line>
            </svg>
          </button>
          <button class="icon-btn alignment-btn" data-align="right" title="Align Right">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="21" y1="10" x2="7" y2="10"></line>
              <line x1="21" y1="6" x2="3" y2="6"></line>
              <line x1="21" y1="14" x2="3" y2="14"></line>
              <line x1="21" y1="18" x2="7" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="toolbar-section">
          <span class="toolbar-label" id="table-dimensions">3 columns Ã— 3 rows</span>
        </div>
      </div>

      <div class="table-editor-body">
        <table id="editable-table">
          <thead>
            <tr>
              <th contenteditable="true" data-col="0" data-row="0">Header 1</th>
              <th contenteditable="true" data-col="1" data-row="0">Header 2</th>
              <th contenteditable="true" data-col="2" data-row="0">Header 3</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td contenteditable="true" data-col="0" data-row="1">Cell 1</td>
              <td contenteditable="true" data-col="1" data-row="1">Cell 2</td>
              <td contenteditable="true" data-col="2" data-row="1">Cell 3</td>
            </tr>
            <tr>
              <td contenteditable="true" data-col="0" data-row="2">Cell 4</td>
              <td contenteditable="true" data-col="1" data-row="2">Cell 5</td>
              <td contenteditable="true" data-col="2" data-row="2">Cell 6</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="table-editor-footer">
        <button class="btn-secondary" id="table-editor-cancel">Cancel</button>
        <button class="btn-primary" id="table-editor-insert">Insert Table</button>
      </div>
    </div>
  </div>

  <!-- AI Assistant Modal -->
  <div class="modal" id="ai-modal" style="display: none;">
    <div class="ai-modal-content">
      <div class="ai-modal-header">
        <h3>âœ¨ AI Assistant</h3>
        <button class="icon-btn" id="ai-modal-close" title="Close">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="ai-modal-body">
        <p class="ai-hint">Ask me to generate or modify markdown content</p>
        <textarea id="ai-prompt-input" placeholder="e.g., Give me a project plan for a small electron notetaking app" rows="3"></textarea>
        <div class="ai-examples">
          <span class="ai-example-label">Examples:</span>
          <button class="ai-example-btn" data-prompt="Create a project plan for a markdown notes app">Project Plan</button>
          <button class="ai-example-btn" data-prompt="Add a table comparing 3 programming languages">Add Table</button>
          <button class="ai-example-btn" data-prompt="Reformat and organize this document">Reorganize</button>
        </div>
      </div>
      <div class="ai-modal-footer">
        <button class="btn-secondary" id="ai-modal-cancel">Cancel</button>
        <button class="btn-primary ai-generate-btn" id="ai-modal-generate">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
            <path d="M14 4.4375C15.3462 4.4375 16.4375 3.34619 16.4375 2H17.5625C17.5625 3.34619 18.6538 4.4375 20 4.4375V5.5625C18.6538 5.5625 17.5625 6.65381 17.5625 8H16.4375C16.4375 6.65381 15.3462 5.5625 14 5.5625V4.4375ZM1 11C4.31371 11 7 8.31371 7 5H9C9 8.31371 11.6863 11 15 11V13C11.6863 13 9 15.6863 9 19H7C7 15.6863 4.31371 13 1 13V11ZM17.25 14C17.25 15.7949 15.7949 17.25 14 17.25V18.75C15.7949 18.75 17.25 20.2051 17.25 22H18.75C18.75 20.2051 20.2051 18.75 22 18.75V17.25C20.2051 17.25 18.75 15.7949 18.75 14H17.25Z"></path>
          </svg>
          Generate
        </button>
      </div>
    </div>
  </div>

  <!-- AI Loading Overlay -->
  <div class="ai-loading-overlay" id="ai-loading-overlay" style="display: none;">
    <div class="ai-loading-content">
      <div class="ai-spinner"></div>
      <p class="ai-loading-text">Generating markdown...</p>
      <p class="ai-loading-subtext">This may take a few seconds</p>
    </div>
  </div>

  <!-- AI Setup Modal -->
  <div class="modal" id="ai-setup-modal" style="display: none;">
    <div class="ai-setup-content">
      <div class="ai-setup-header">
        <h2>ðŸš€ Setup AI Assistant</h2>
      </div>
      <div class="ai-setup-body">
        <p class="ai-setup-description">To use the AI Assistant, you need a free GitHub token. This gives you access to powerful AI models at no cost!</p>
        
        <div class="ai-setup-steps">
          <div class="ai-setup-step">
            <span class="ai-step-number">1</span>
            <div class="ai-step-content">
              <h4>Get Your Free GitHub Token</h4>
              <p>Visit <a href="#" id="github-token-link" class="ai-link">github.com/settings/tokens</a></p>
              <p class="ai-step-detail">Create a new token (Classic) with <strong>no scopes selected</strong> - you only need the basic token!</p>
            </div>
          </div>
          
          <div class="ai-setup-step">
            <span class="ai-step-number">2</span>
            <div class="ai-step-content">
              <h4>Paste Your Token Below</h4>
              <input type="password" id="ai-setup-token-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" />
              <p class="ai-step-detail">Your token is stored locally and never shared</p>
            </div>
          </div>
          
          <div class="ai-setup-step">
            <span class="ai-step-number">3</span>
            <div class="ai-step-content">
              <h4>Choose Your Model</h4>
              <select id="ai-setup-model-select">
                <option value="gpt-4o-mini" selected>GPT-4o Mini (Fast & Free)</option>
                <option value="gpt-4o">GPT-4o (More Capable)</option>
                <option value="Llama-3.2-90B-Vision-Instruct">Llama 3.2 90B (Open Source)</option>
                <option value="Phi-3.5-mini-instruct">Phi 3.5 Mini (Lightweight)</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="ai-setup-footer">
        <button class="btn-secondary" id="ai-setup-cancel">Cancel</button>
        <button class="btn-primary" id="ai-setup-save">Save & Start Using AI</button>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
